{"version":3,"sources":["components/modals/TransactionStatusModal/TransactionStatusModal.tsx"],"names":["Wrapper","Header","Title","Desc","CloseWrapper","CloseIcon","BlockWrapper","CheckmarkIcon","OtherIcon","ProgressWrapper","ProgressLine","Content","SendWrapper","ValueCurrency","ValueOriginal","SwapWrapper","SwapColumn","SwapInfo","SwapBlock","SwapIcon","SwapAmount","FieldsWrapper","FieldWrapper","FieldTitle","FieldValue","CopyIcon","CopyWrapper","Footer","ButtonExplorer","TransactionStatusModal","close","dispatch","useDispatch","useState","transaction","useSelector","state","signature","Transaction","cluster","tokenAccounts","useEffect","newProgress","timerId","setInterval","setProgress","progress","clearTimeout","executeAction","a","setIsExecuting","unwrapResult","resultSignature","setSignature","setIsError","ToastManager","mount","getTransaction","setTimeout","publicKey","isReceiver","useMemo","tokenAccount","handleCloseClick","isProcessing","isSuccess","type","fromToken","onClick","name","className","classNames","isError","style","width","prefix","symbol","value","size","toToken","navigator","error","console","primary","disabled","lightGray","href","getExplorerUrl","target","rel"],"mappings":"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","file":"static/js/6.ed9cf80b.chunk.js","sourcesContent":["// eslint-disable-next-line eslint-comments/disable-enable-pair\n/* eslint-disable unicorn/no-nested-ternary */\nimport React, { FunctionComponent, useEffect, useMemo, useState } from 'react';\nimport { useDispatch, useSelector } from 'react-redux';\n\nimport { styled } from '@linaria/react';\nimport { AsyncThunkAction, unwrapResult } from '@reduxjs/toolkit';\nimport classNames from 'classnames';\nimport { Decimal } from 'decimal.js';\nimport { rgba } from 'polished';\n\nimport { Token } from 'api/token/Token';\nimport { Transaction } from 'api/transaction/Transaction';\nimport { AmountUSD } from 'components/common/AmountUSD';\nimport { ToastManager } from 'components/common/ToastManager';\nimport { TokenAvatar } from 'components/common/TokenAvatar';\nimport { Button, Icon } from 'components/ui';\nimport { getTransaction } from 'store/slices/transaction/TransactionSlice';\nimport { getExplorerUrl } from 'utils/connection';\n\nconst INITIAL_PROGRESS = 5;\n\nconst Wrapper = styled.div`\n  position: relative;\n\n  display: flex;\n  flex-basis: 524px;\n  flex-direction: column;\n  overflow: hidden;\n\n  background: #fff;\n\n  border-radius: 15px;\n`;\n\nconst Header = styled.div`\n  position: relative;\n\n  padding: 26px 20px 50px;\n\n  text-align: center;\n`;\n\nconst Title = styled.div`\n  margin-bottom: 10px;\n\n  color: #000;\n  font-weight: bold;\n  font-size: 20px;\n  line-height: 100%;\n`;\n\nconst Desc = styled.div`\n  color: #a3a5ba;\n  font-weight: 600;\n  font-size: 16px;\n  line-height: 100%;\n`;\n\nconst CloseWrapper = styled.div`\n  position: absolute;\n  top: 15px;\n  right: 15px;\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 32px;\n  height: 32px;\n\n  background: #f6f6f8;\n  border-radius: 8px;\n\n  cursor: pointer;\n`;\n\nconst CloseIcon = styled(Icon)`\n  width: 16px;\n  height: 16px;\n\n  color: #a3a5ba;\n`;\n\nconst BlockWrapper = styled.div`\n  position: absolute;\n  bottom: -28px;\n  left: 50%;\n\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  width: 55px;\n  height: 55px;\n  margin-left: -27px;\n\n  background: #5887ff;\n  border-radius: 12px;\n\n  &.isProcessing {\n    background: #ffd177;\n  }\n\n  &.isSuccess {\n    background: #77db7c;\n  }\n\n  &.isError {\n    background: #f77;\n  }\n`;\n\nconst CheckmarkIcon = styled(Icon)`\n  width: 45px;\n  height: 45px;\n\n  color: #fff;\n`;\n\nconst OtherIcon = styled(Icon)`\n  width: 37px;\n  height: 37px;\n\n  color: #fff;\n`;\n\nconst ProgressWrapper = styled.div`\n  height: 1px;\n\n  background: rgba(0, 0, 0, 0.05);\n`;\n\nconst ProgressLine = styled.div`\n  width: ${INITIAL_PROGRESS}%;\n  height: 1px;\n\n  background: #5887ff;\n\n  transition: width 0.15s;\n`;\n\nconst Content = styled.div``;\n\nconst SendWrapper = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  margin: 40px 0 20px;\n`;\n\nconst ValueCurrency = styled.div`\n  color: #000;\n  font-weight: 600;\n  font-size: 28px;\n  line-height: 120%;\n`;\n\nconst ValueOriginal = styled.div`\n  margin-top: 4px;\n\n  color: #a3a5ba;\n  font-weight: 600;\n  font-size: 16px;\n  line-height: 120%;\n`;\n\nconst SwapWrapper = styled.div`\n  display: flex;\n  justify-content: center;\n\n  margin: 70px 0 40px;\n`;\n\nconst SwapColumn = styled.div`\n  display: flex;\n  flex: 1;\n  align-items: center;\n\n  &:not(:first-child) {\n    justify-content: flex-start;\n  }\n\n  &:not(:last-child) {\n    justify-content: flex-end;\n  }\n`;\n\nconst SwapInfo = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n`;\n\nconst SwapBlock = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n\n  width: 32px;\n  height: 32px;\n  margin: 6px 26px 0;\n\n  background: #f6f6f8;\n  border-radius: 12px;\n`;\n\nconst SwapIcon = styled(Icon)`\n  width: 24px;\n  height: 24px;\n\n  color: #a3a5ba;\n`;\n\nconst SwapAmount = styled.div`\n  margin-top: 10px;\n\n  color: #000;\n  font-weight: 600;\n  font-size: 18px;\n  line-height: 120%;\n`;\n\nconst FieldsWrapper = styled.div``;\n\nconst FieldWrapper = styled.div`\n  padding: 16px 30px;\n\n  &:first-child {\n    border-top: 1px solid ${rgba('#000', 0.05)};\n  }\n\n  &:not(:last-child) {\n    border-bottom: 1px solid ${rgba('#000', 0.05)};\n  }\n`;\n\nconst FieldTitle = styled.div`\n  color: #a3a5ba;\n  font-weight: 600;\n  font-size: 14px;\n  line-height: 21px;\n`;\n\nconst FieldValue = styled.div`\n  display: flex;\n  align-items: center;\n  margin-top: 3px;\n\n  font-weight: 600;\n  font-size: 14px;\n  line-height: 21px;\n`;\n\nconst CopyIcon = styled(Icon)`\n  width: 24px;\n  height: 24px;\n\n  color: #a3a5ba;\n`;\n\nconst CopyWrapper = styled.div`\n  display: flex;\n  flex-shrink: 0;\n  align-items: center;\n  justify-content: center;\n  width: 36px;\n  height: 36px;\n  margin-left: 20px;\n\n  background: rgba(163, 165, 186, 0.1);\n  border-radius: 8px;\n  cursor: pointer;\n\n  &:hover {\n    background: #eff3ff;\n\n    ${CopyIcon} {\n      color: #5887ff;\n    }\n  }\n`;\n\nconst Footer = styled.div`\n  display: flex;\n  align-items: center;\n  padding: 24px 20px;\n\n  border-top: 1px solid ${rgba('#000', 0.05)};\n\n  & > :not(:last-child) {\n    margin-right: 16px;\n  }\n`;\n\nconst ButtonExplorer = styled(Button)`\n  font-weight: 600;\n  font-size: 14px;\n  line-height: 150%;\n`;\n\ntype Props = {\n  type: 'send' | 'swap';\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  action: AsyncThunkAction<string, any, any>;\n  fromToken: Token;\n  fromAmount: Decimal;\n  toToken?: Token;\n  toAmount?: Decimal;\n  close: (signature: string | null) => void;\n};\n\nconst handleCopyClick = (publicKey: string) => () => {\n  try {\n    void navigator.clipboard.writeText(publicKey);\n    ToastManager.info('Copied to buffer!');\n  } catch (error) {\n    console.error(error);\n  }\n};\n\nexport const TransactionStatusModal: FunctionComponent<Props> = ({\n  type,\n  action,\n  fromToken,\n  fromAmount,\n  toToken,\n  toAmount,\n  close,\n}) => {\n  const dispatch = useDispatch();\n  const [progress, setProgress] = useState(5);\n  const [isExecuting, setIsExecuting] = useState(false);\n  const [isError, setIsError] = useState(false);\n  const [signature, setSignature] = useState<string | null>(null);\n  const transaction = useSelector(\n    (state) =>\n      (signature &&\n        state.transaction.items[signature] &&\n        Transaction.from(state.transaction.items[signature])) ||\n      null,\n  );\n  const cluster = useSelector((state) => state.wallet.cluster);\n  const tokenAccounts = useSelector((state) => state.wallet.tokenAccounts);\n\n  useEffect(() => {\n    let newProgress = INITIAL_PROGRESS;\n\n    if (!isExecuting) {\n      return;\n    }\n\n    const timerId = setInterval(() => {\n      if (progress <= 95) {\n        newProgress += 7;\n        setProgress(newProgress);\n      } else {\n        newProgress = 95;\n        setProgress(newProgress);\n      }\n    }, 2500);\n\n    return () => {\n      clearTimeout(timerId);\n      setProgress(100);\n    };\n  }, [isExecuting]);\n\n  const executeAction = async () => {\n    try {\n      setIsExecuting(true);\n\n      const resultSignature = unwrapResult(await dispatch(action));\n      setSignature(resultSignature);\n    } catch (error) {\n      setIsError(true);\n      setIsExecuting(false);\n      ToastManager.error((error as Error).message);\n    }\n  };\n\n  useEffect(() => {\n    void executeAction();\n  }, []);\n\n  useEffect(() => {\n    const mount = async () => {\n      if (!signature) {\n        return;\n      }\n\n      try {\n        const trx = unwrapResult(await dispatch(getTransaction(signature)));\n\n        if (!trx) {\n          setTimeout(mount, 3000);\n          return;\n        }\n      } catch (error) {\n        setIsError(true);\n        setIsExecuting(false);\n        ToastManager.error((error as Error).message);\n      }\n\n      setIsExecuting(false);\n    };\n\n    void mount();\n  }, [signature]);\n\n  const isReceiver = useMemo(() => {\n    if (!transaction) {\n      return null;\n    }\n\n    return tokenAccounts.find(\n      (tokenAccount) => tokenAccount.address === transaction.short.destination?.toBase58(),\n    );\n  }, [transaction?.short.destination, tokenAccounts]);\n\n  const handleRetryClick = () => {\n    void executeAction();\n  };\n\n  const handleCloseClick = () => {\n    close(signature);\n  };\n\n  const isProcessing = !signature || !transaction;\n  const isSuccess = signature && transaction;\n\n  const renderTitle = () => {\n    if (isSuccess) {\n      return 'Success';\n    }\n\n    if (isError) {\n      return 'Something went wrong';\n    }\n\n    return type === 'send' ? 'Sending...' : 'Swapping...';\n  };\n\n  const renderDescription = () => {\n    if (isSuccess) {\n      return type === 'send'\n        ? `You’ve successfully sent ${fromToken.symbol}`\n        : 'You’ve successfully swapped tokens';\n    }\n\n    if (isError) {\n      return type === 'send' ? 'Tokens have not been debited' : 'Tokens have not been swapped';\n    }\n\n    return 'Transaction processing';\n  };\n\n  return (\n    <Wrapper>\n      <Header>\n        <Title>{renderTitle()}</Title>\n        <Desc>{renderDescription()}</Desc>\n        <CloseWrapper onClick={handleCloseClick}>\n          <CloseIcon name=\"close\" />\n        </CloseWrapper>\n        <BlockWrapper\n          className={classNames({\n            isProcessing,\n            isSuccess,\n            isError,\n          })}>\n          {isSuccess ? (\n            <CheckmarkIcon name=\"checkmark\" />\n          ) : (\n            <OtherIcon name={isError ? 'warning' : 'timer'} />\n          )}\n        </BlockWrapper>\n      </Header>\n      <ProgressWrapper>\n        <ProgressLine style={{ width: `${progress}%` }} />\n      </ProgressWrapper>\n      <Content>\n        {type === 'send' ? (\n          <SendWrapper>\n            <ValueCurrency>\n              {isReceiver ? '+' : '-'}{' '}\n              {transaction?.short.destinationAmount.toNumber() ||\n                fromToken.toMajorDenomination(fromAmount).toString()}{' '}\n              {transaction?.short.sourceTokenAccount?.mint.symbol || fromToken.symbol}\n            </ValueCurrency>\n            <ValueOriginal>\n              <AmountUSD\n                prefix={isReceiver ? '+' : '-'}\n                symbol={transaction?.short.sourceTokenAccount?.mint.symbol || fromToken.symbol}\n                value={\n                  transaction?.short.destinationAmount || fromToken.toMajorDenomination(fromAmount)\n                }\n              />\n            </ValueOriginal>\n          </SendWrapper>\n        ) : undefined}\n        {/* // TODO: actual swap transaction details */}\n        {type === 'swap' && toToken && toAmount ? (\n          <SwapWrapper>\n            <SwapColumn>\n              <SwapInfo>\n                <TokenAvatar size={44} symbol={fromToken.symbol} />\n                <SwapAmount>\n                  - {fromToken.toMajorDenomination(fromAmount).toString()} {fromToken.symbol}\n                </SwapAmount>\n              </SwapInfo>\n            </SwapColumn>\n            <SwapBlock>\n              <SwapIcon name=\"swap\" />\n            </SwapBlock>\n            <SwapColumn>\n              <SwapInfo>\n                <TokenAvatar size={44} symbol={toToken.symbol} />\n                <SwapAmount>\n                  + {toToken.toMajorDenomination(toAmount).toString()} {toToken.symbol}\n                </SwapAmount>\n              </SwapInfo>\n            </SwapColumn>\n          </SwapWrapper>\n        ) : undefined}\n        {signature ? (\n          <FieldsWrapper>\n            <FieldWrapper>\n              <FieldTitle>Transaction ID</FieldTitle>\n              <FieldValue>\n                {signature}{' '}\n                <CopyWrapper onClick={handleCopyClick(signature)}>\n                  <CopyIcon name=\"copy\" />\n                </CopyWrapper>\n              </FieldValue>\n            </FieldWrapper>\n          </FieldsWrapper>\n        ) : undefined}\n      </Content>\n      <Footer>\n        {isError ? (\n          <>\n            <Button primary disabled={isExecuting} onClick={handleRetryClick}>\n              Try again\n            </Button>\n            <Button lightGray disabled={isExecuting} onClick={handleCloseClick}>\n              Cancel\n            </Button>\n          </>\n        ) : (\n          <>\n            <Button primary onClick={handleCloseClick}>\n              Done\n            </Button>\n            {signature ? (\n              <a\n                href={getExplorerUrl('tx', signature, cluster)}\n                target=\"_blank\"\n                rel=\"noopener noreferrer noindex\"\n                className=\"button\">\n                <ButtonExplorer lightGray>View in blockchain explorer</ButtonExplorer>\n              </a>\n            ) : undefined}\n          </>\n        )}\n      </Footer>\n    </Wrapper>\n  );\n};\n"],"sourceRoot":""}